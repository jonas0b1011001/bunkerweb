{% extends "base.html" %}
{% block content %}
<div class="col-span-3 lg:col-span-3 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h4>Total requests</h4>
    <strong>{{ data.total_requests }}</strong>
</div>
<div class="col-span-3 lg:col-span-3 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h4>4xx Error</h4>
    <strong>{{ data.requests_4xx_percent }}%</strong>
</div>
<div class="col-span-3 lg:col-span-3 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h4>5xx Error</h4>
    <strong>{{ data.requests_5xx_percent }}%</strong>
</div>
<div class="col-span-3 lg:col-span-3 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h4>Unique IPs</h4>
    <strong>{{ data.unique_ips }}</strong>
</div>
<div class="col-span-4 lg:col-span-4 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h2>Status Codes</h2>
    <canvas id="statusCodesChart"></canvas>
</div>

<div class="col-span-4 lg:col-span-4 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h2>Top Hostnames</h2>
    <canvas id="topHostsChart"></canvas>
</div>

<div class="col-span-4 lg:col-span-4 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h2>Top IPs</h2>
    <canvas id="topIPsChart"></canvas>
</div>

<div class="col-span-4 lg:col-span-4 p-4 w-full bg-white dark:bg-slate-850 shadow-md rounded-2xl">
    <h2>Top User-Agents</h2>
    <canvas id="topUserAgentsChart"></canvas>
</div>

<script nonce="{{ script_nonce }}">
    // Status-Codes Doughnut-Chart
    new Chart(document.getElementById('statusCodesChart'), {
        type: 'doughnut',
        data: {
            labels: [{% for status, _ in data.status_codes %} "{{ status }}", {% endfor %}],
            datasets: [{
                label: 'Status-Codes',
                data: [{% for _, count in data.status_codes %} {{ count }}, {% endfor %}],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    // Top 5 Hosts Doughnut-Chart
    new Chart(document.getElementById('topHostsChart'), {
        type: 'doughnut',
        data: {
            labels: [{% for host, _ in data.top_hosts %} "{{ host }}", {% endfor %}],
            datasets: [{
                label: 'Top Hosts',
                data: [{% for _, count in data.top_hosts %} {{ count }}, {% endfor %}],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    // Top 5 IPs Doughnut-Chart
    new Chart(document.getElementById('topIPsChart'), {
        type: 'doughnut',
        data: {
            labels: [{% for ip, _ in data.top_ips %} "{{ ip }}", {% endfor %}],
            datasets: [{
                label: 'Top IPs',
                data: [{% for _, count in data.top_ips %} {{ count }}, {% endfor %}],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
    });

    // Top 5 User-Agents Doughnut-Chart
    new Chart(document.getElementById('topUserAgentsChart'), {
        type: 'doughnut',
        data: {
            labels: [{% for agent, _ in data.top_user_agents %} "{{ agent }}", {% endfor %}],
            datasets: [{
                label: 'Top User-Agents',
                data: [{% for _, count in data.top_user_agents %} {{ count }}, {% endfor %}],
                backgroundColor: [
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        }
    });
</script>
{% endblock content %}